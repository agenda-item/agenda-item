<div id="app">
    <agenda-item :agenda-item="agendaItem" :selected="selected" :options="options"></agenda-item>
  <button id="show-modal" @click="showModal = true" class="button is-primary modal-button">Change Mover</button>
  <!-- use the modal component, pass in the prop -->
  <modal :show.sync="showModal">
    <!--
      you can use custom content here to overwrite
      default content
    -->
  </modal>
</div>

<template id="agenda-item-template" >
 <form @submit.prevent="postData">
    <label>Title:</label>
    <br>
    <textarea id="title" v-model="agendaItem.title" name="title"></textarea>
    <br>
    <label>Description:</label>
    <br>
    <textarea id="description" v-model="agendaItem.description"  name="description"></textarea>
    <br>
    <label>Discussion:</label>
    <br>
    <textarea id="discussion" v-model="agendaItem.discussion" name="discussion"></textarea>
    <br>
    <label>Status:</label>
    <br>
    <textarea id="status" v-model="agendaItem.status" name="status"></textarea>
    <br>
    <label>Mover:</label>
    <br>
    <textarea id="mover_id" v-model="agendaItem.mover_id" name="mover_id"></textarea>
    <div id="mover_first_name">{{agendaItem.mover.first_name}}</div>
    <select v-model="agendaItem.status">
      <option v-for="option in options" v-bind:value="option.value">
        {{ option.text }}
      </option>
    </select>
    <br>
    <button type="submit">submit</button>
  </form>
</template>

<!-- template for the modal component -->
<template id="modal-template">
  <div class="modal-mask" v-show="show" transition="modal">
    <div class="modal-wrapper">
      <div class="modal-container">

        <div class="modal-header">
          <slot name="header">
            Select a new mover:
          </slot>
        </div>
        
        <div class="modal-body">
          <slot name="body">
            <div v-for="user in userList">
              <span class="tag" v-bind:class="{ 'is-primary': isPrimary }"><i class="fa fa-checkbox-marked-circle-outline fa-lg" aria-hidden="true" @click="selectMover" :user="user">{{ user.first_name }}</i></span>
            </div>
          </slot>
        </div>

        <div class="modal-footer">
          <slot name="footer">
            Are you sure?
            <button class="button is-primary modal-button"
              @click="show = false">
              Yes
            </button>
          </slot>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
  Vue.component('agendaItem', {
    template: '#agenda-item-template',
    props: ['agendaItem', 'selected', 'options'],
    methods: {
      postData: function() {
        console.log(this)
        this.$http.post('/api/mover/' + this.agendaItem.id, this.agendaItem, {emulateJSON:true}).then(function(response) {
          console.log("agenda item updated");
        }).error(function(error) {
          console.log(error);
          console.log("erroring");
        }.bind(this));
      }
    }
  });


  Vue.component('modal', {
    template: '#modal-template',
    data: function() {
      return {
        userList: [],
        isPrimary: false
      }
    },
    props: {
      user: ['user'],
      show: {
        type: Boolean,
        required: true,
        twoWay: true    
      }
    },
    created: function() {
      this.$http.get('/api/users').then(function(response){
        this.userList = response.json();
        console.log(this.userList)
      }.bind(this));
    },
    methods: {
      selectMover: function() {
        this.isPrimary = !this.isPrimary;
      }
    }
  })

  new Vue({
    el: '#app',
    data: {
      agendaItem: {},
      selected: '--',
      options: [
        { text: 'passed', value: 'passed' },
        { text: 'defeated', value: 'defeated' },
        { text: 'amended', value: 'amended' },
        { text: 'active', value: 'active' },
        { text: 'carried forward', value: 'carried forward' },
        { text: 'completed', value: 'completed' }
      ],
      showModal: false
     },
    created: function() {
      this.$http.get('/api/mover/5').then(function(response){
        this.agendaItem = response.json();
      }.bind(this));
    }
  });
</script>