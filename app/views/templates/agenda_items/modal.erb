<template id="modal-template">
  <button class="button" @click.prevent="openModal">Log Mover and Seconder</button>

    <div class="modal-background"></div>
    <div class="modal-card">
      <header class="modal-card-head">
        <h1 class="title is-2" v-if="agendaItem.type === 'Election'" class="modal-card-title">
          Select Mover and Seconder</h1>
      </header>
      <section class="modal-card-body">
        <list-users :agenda-item.sync="agendaItem" :mover.sync="mover" :seconder.sync="seconder"></list-users>
      </section>
      <footer class="modal-card-foot">
        <button class="button" @click.prevent="closeModal">Close</button>
      </footer>
    </div>
  </div>
</template>

<script>
  Vue.component('modal', {
    template: '#modal-template',
    props: ['agendaItem', 'mover', 'seconder'],
    data: function(){
      return {
        showModal: false
      }
    },
    methods: {
      openModal: function() {
        this.showModal = true
      },
      closeModal: function() {
        this.showModal = false
      }
    }
  })
</script>

<template id="list-users-template">

  <div class="modal-section">
    <div id="select-mover">
      <div v-if="mover">
        <h2 class="subtitle is-6"><strong>The Current Mover is:</strong> {{mover.first_name}}</h2>
      </div>
      <p>Click to select the member who moved the Agenda Item:<p>
          <ul v-for="user in usersList">
            <mover :agenda-item.sync="agendaItem" :user="user" :mover.sync="mover"></mover>
          </ul>
        </div>
      </div>
      <div class="modal-section">
        <div id="select-seconder">
          <div v-if="seconder">
            <h2 class="subtitle is-6"><strong>The Current Seconder is:</strong> {{seconder.first_name}}</h2>
          </div>
          <p>Click to select the member who seconded the Agenda Item:<p>
              <ul v-for="user in usersList">
                <seconder :agenda-item.sync="agendaItem" :user="user" :seconder.sync="seconder"></seconder>
              </ul>
            </div>
          </div>

</template>


<script>
  Vue.component('list-users', {
    template: '#list-users-template',
    props: ['agendaItem','mover','seconder'],
    data: function() {
      return {
        usersList: []
      }
    },
    created: function() {
      this.$http.get('/api/users').then(function(response){
        this.usersList = response.json()
      }.bind(this));
    }
  })
</script>

<template id="mover-template">
  <div class="ai-user" @click="setMover">
    <i class="fa fa-person" aria-hidden="true">
      {{user.first_name}} {{user.last_name}}
    </i>
  </div>
</template>

<script>
  Vue.component('mover', {
    template: '#mover-template',
    props: ['agendaItem','user','mover'],
    methods: {
      setMover: function(){
        this.$http.post('/api/agenda-items/2/mover', {'mover_id': this.user.id}, {emulateJSON:true}).then(function(response){
          this.mover = response.json()
        }.bind(this));
      }
    }
  })
</script>

<template id="seconder-template">
  <div class="ai-user" @click="setSeconder">
    <i class="fa fa-person" aria-hidden="true">
      {{user.first_name}} {{user.last_name}}
    </i>
  </div>
</template>

<script>
  Vue.component('seconder', {
    template: '#seconder-template',
    props: ['agendaItem','user','seconder'],
    methods: {
      setSeconder: function(){
        this.$http.post('/api/agenda-items/2/seconder', {'seconder_id': this.user.id}, {emulateJSON:true}).then(function(response){
          this.seconder = response.json()
        }.bind(this));
      }
    }
  })
</script>

